<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Weather Duck RPG - Touch Controls</title>
<style>
* {margin:0;padding:0;box-sizing:border-box;}
html, body {width:100%;height:100%;overflow:hidden;touch-action:none;background:#1a1a2e;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;}
#iframe-game {width:100%;height:100%;border:none;display:block;}

/* Joysticks */
.joystick-container {position:fixed;bottom:40px;width:140px;height:140px;background:radial-gradient(circle at 30% 30%, rgba(80,80,100,0.6) 0%, rgba(40,40,60,0.8) 100%);border-radius:50%;border:4px solid rgba(255,255,255,0.3);touch-action:none;z-index:1000;box-shadow:0 8px 32px rgba(0,0,0,0.4), inset 0 2px 10px rgba(255,255,255,0.1), inset 0 -5px 20px rgba(0,0,0,0.3);user-select:none;-webkit-user-select:none;}
#joystick-container-left {left:40px;}
#joystick-container-right {right:40px;}
.joystick-container::before {content:'';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:80%;height:80%;border-radius:50%;border:2px dashed rgba(255,255,255,0.15);}
.joystick-knob {position:absolute;width:60px;height:60px;background:radial-gradient(circle at 30% 30%, #fff 0%, #e0e0e0 40%, #b0b0b0 100%);border-radius:50%;top:50%;left:50%;transform:translate(-50%,-50%);cursor:grab;touch-action:none;box-shadow:0 6px 20px rgba(0,0,0,0.4), inset 0 2px 5px rgba(255,255,255,0.8), inset 0 -2px 5px rgba(0,0,0,0.2);transition:transform 0.1s ease-out,box-shadow 0.1s;user-select:none;-webkit-user-select:none;}
.joystick-knob.active {cursor:grabbing;box-shadow:0 3px 15px rgba(0,0,0,0.5), inset 0 2px 5px rgba(255,255,255,0.8), inset 0 -2px 5px rgba(0,0,0,0.2);}
.joystick-knob.active::after {content:'';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:20px;height:20px;background:radial-gradient(circle,#ffcc00 0%,#ff9900 100%);border-radius:50%;box-shadow:0 0 15px #ffcc00;}

/* Direction displays */
.direction-display {position:fixed;bottom:195px;color:#fff;font-size:13px;font-weight:600;text-shadow:1px 1px 3px rgba(0,0,0,0.8);z-index:1000;background:rgba(0,0,0,0.6);padding:8px 14px;border-radius:20px;backdrop-filter:blur(5px);min-width:140px;text-align:center;}
#direction-display-left {left:40px;}
#direction-display-right {right:40px;}

/* Arrow indicator */
#arrow-indicator {position:fixed;bottom:235px;left:40px;width:140px;height:100px;z-index:1000;display:grid;grid-template-columns:repeat(3,1fr);grid-template-rows:repeat(3,1fr);gap:3px;background:rgba(0,0,0,0.4);padding:8px;border-radius:12px;backdrop-filter:blur(5px);}
.arrow-cell {display:flex;align-items:center;justify-content:center;font-size:18px;color:rgba(255,255,255,0.25);text-shadow:1px 1px 2px rgba(0,0,0,0.5);border-radius:6px;transition:all 0.1s ease;}
.arrow-cell.active {color:#ffcc00;text-shadow:0 0 15px #ffcc00,0 0 30px #ff9900;background:rgba(255,204,0,0.15);transform:scale(1.1);}
.arrow-cell.center {color:rgba(255,255,255,0.1);font-size:10px;}

/* Instructions */
#instructions {position:fixed;top:15px;left:50%;transform:translateX(-50%);color:white;font-size:13px;background:rgba(0,0,0,0.7);padding:10px 25px;border-radius:25px;z-index:1000;backdrop-filter:blur(5px);box-shadow:0 4px 15px rgba(0,0,0,0.3);transition:opacity 0.5s;}
#instructions.hidden {opacity:0;pointer-events:none;}

/* Keys display */
#keys-display {position:fixed;bottom:350px;left:40px;color:#aaa;font-size:11px;z-index:1000;background:rgba(0,0,0,0.5);padding:6px 12px;border-radius:8px;backdrop-filter:blur(5px);font-family:monospace;}
.key-badge {display:inline-block;background:rgba(255,255,255,0.15);padding:2px 8px;border-radius:4px;margin:0 2px;border:1px solid rgba(255,255,255,0.2);}
.key-badge.active {background:rgba(255,204,0,0.3);border-color:#ffcc00;color:#ffcc00;}

/* Action buttons */
#action-buttons {position:fixed;bottom:80px;right:40px;display:flex;flex-direction:column;gap:15px;z-index:1000;}
.action-btn {width:70px;height:70px;border-radius:50%;border:3px solid rgba(255,255,255,0.3);background:radial-gradient(circle at 30% 30%, rgba(100,100,120,0.7)0%,rgba(60,60,80,0.9)100%);color:white;font-size:12px;font-weight:bold;cursor:pointer;touch-action:none;user-select:none;-webkit-user-select:none;box-shadow:0 6px 20px rgba(0,0,0,0.4),inset 0 2px 5px rgba(255,255,255,0.1);transition:all 0.1s;display:flex;flex-direction:column;align-items:center;justify-content:center;}
.action-btn:active {transform:scale(0.95);box-shadow:0 3px 10px rgba(0,0,0,0.5),inset 0 2px 5px rgba(255,255,255,0.1);}
.action-btn .icon {font-size:24px;margin-bottom:2px;}
.action-btn.primary {background:radial-gradient(circle at 30% 30%, rgba(255,180,0,0.8)0%,rgba(200,120,0,0.9)100%);}
.action-btn.secondary {background:radial-gradient(circle at 30% 30%, rgba(80,180,255,0.7)0%,rgba(40,120,200,0.9)100%);}
</style>
</head>
<body>
<iframe id="game-frame" src="frontend/rpg-2-0.html" allow="autoplay"></iframe>

<div id="instructions">üéÆ Drag joystick to move ‚Ä¢ Tap buttons for actions</div>

<!-- Arrow indicator -->
<div id="arrow-indicator">
<div class="arrow-cell" data-dir="leftup">‚Üñ</div>
<div class="arrow-cell" data-dir="up">‚Üë</div>
<div class="arrow-cell" data-dir="rightup">‚Üó</div>
<div class="arrow-cell" data-dir="left">‚Üê</div>
<div class="arrow-cell center">‚óè</div>
<div class="arrow-cell" data-dir="right">‚Üí</div>
<div class="arrow-cell" data-dir="leftdown">‚Üô</div>
<div class="arrow-cell" data-dir="down">‚Üì</div>
<div class="arrow-cell" data-dir="rightdown">‚Üò</div>
</div>

<!-- Left joystick -->
<div id="joystick-container-left" class="joystick-container">
<div id="joystick-knob-left" class="joystick-knob"></div>
</div>
<div id="direction-display-left" class="direction-display">‚è∏ IDLE</div>

<!-- Right joystick -->
<div id="joystick-container-right" class="joystick-container">
<div id="joystick-knob-right" class="joystick-knob"></div>
</div>
<div id="direction-display-right" class="direction-display">‚è∏ IDLE</div>

<div id="keys-display">
Keys: 
<span class="key-badge" id="key-up">‚Üë</span>
<span class="key-badge" id="key-down">‚Üì</span>
<span class="key-badge" id="key-left">‚Üê</span>
<span class="key-badge" id="key-right">‚Üí</span>
</div>

<!-- Action buttons -->
<div id="action-buttons">
<button class="action-btn primary" id="btn-action" data-key=" ">
<span class="icon">‚ö°</span><span>Action</span>
</button>
<button class="action-btn secondary" id="btn-menu" data-key="Escape">
<span class="icon">‚ò∞</span><span>Menu</span>
</button>
</div>

<script>
// ===== DOM & IFRAME =====
const gameFrame=document.getElementById('game-frame');
const instructions=document.getElementById('instructions');
const arrowCells=document.querySelectorAll('.arrow-cell[data-dir]');
const keyBadges={
ArrowUp:document.getElementById('key-up'),
ArrowDown:document.getElementById('key-down'),
ArrowLeft:document.getElementById('key-left'),
ArrowRight:document.getElementById('key-right')
};

// ===== JOYSTICKS =====
const joystickData=[
{container:'joystick-container-left',knob:'joystick-knob-left',display:'direction-display-left',keysMapping:{right:['d'],rightdown:['d','s'],down:['s'],leftdown:['a','s'],left:['a'],leftup:['a','w'],up:['w'],rightup:['d','w']}},
{container:'joystick-container-right',knob:'joystick-knob-right',display:'direction-display-right',keysMapping:{right:['ArrowRight'],rightdown:['ArrowRight','ArrowDown'],down:['ArrowDown'],leftdown:['ArrowLeft','ArrowDown'],left:['ArrowLeft'],leftup:['ArrowLeft','ArrowUp'],up:['ArrowUp'],rightup:['ArrowRight','ArrowUp']}}
];
const directionNames={right:'‚û°Ô∏è RIGHT',rightdown:'‚ÜòÔ∏è RIGHT-DOWN',down:'‚¨áÔ∏è DOWN',leftdown:'‚ÜôÔ∏è LEFT-DOWN',left:'‚¨ÖÔ∏è LEFT',leftup:'‚ÜñÔ∏è LEFT-UP',up:'‚¨ÜÔ∏è UP',rightup:'‚ÜóÔ∏è RIGHT-UP'};

joystickData.forEach(joy=>{
joy.containerEl=document.getElementById(joy.container);
joy.knobEl=document.getElementById(joy.knob);
joy.displayEl=document.getElementById(joy.display);
joy.isDragging=false;joy.centerX=0;joy.centerY=0;joy.maxDistance=0;joy.currentDirection=null;joy.pressedKeys=new Set();
});

// ===== UTILITY =====
function initJoystick(joy){const rect=joy.containerEl.getBoundingClientRect();joy.centerX=rect.left+rect.width/2;joy.centerY=rect.top+rect.height/2;joy.maxDistance=(rect.width/2)-30;}
function getDirection(angle){if(angle<0)angle+=360;if(angle>=337.5||angle<22.5)return'right';if(angle>=22.5&&angle<67.5)return'rightdown';if(angle>=67.5&&angle<112.5)return'down';if(angle>=112.5&&angle<157.5)return'leftdown';if(angle>=157.5&&angle<202.5)return'left';if(angle>=202.5&&angle<247.5)return'leftup';if(angle>=247.5&&angle<292.5)return'up';if(angle>=292.5&&angle<337.5)return'rightup';return'right';}
function sendKeyEvent(key,eventType){const eventInit={key:key,code:key===' '?'Space':key,keyCode:key.toUpperCase().charCodeAt(0),which:key.toUpperCase().charCodeAt(0),bubbles:true,cancelable:true,view:window};document.dispatchEvent(new KeyboardEvent(eventType,eventInit));if(keyBadges[key]){keyBadges[key].classList.toggle('active',eventType==='keydown');}}
function updateKeys(joy,newDirection){const newKeys=newDirection?new Set(joy.keysMapping[newDirection]):new Set();for(const key of joy.pressedKeys)if(!newKeys.has(key))sendKeyEvent(key,'keyup');for(const key of newKeys)if(!joy.pressedKeys.has(key))sendKeyEvent(key,'keydown');joy.pressedKeys.clear();for(const key of newKeys)joy.pressedKeys.add(key);}
function handleMove(joy,clientX,clientY){initJoystick(joy);const dx=clientX-joy.centerX,dy=clientY-joy.centerY,distance=Math.sqrt(dx*dx+dy*dy);let moveX=dx,moveY=dy;if(distance>joy.maxDistance){const scale=joy.maxDistance/distance;moveX=dx*scale;moveY=dy*scale;}joy.knobEl.style.left=`calc(50% + ${moveX}px)`;joy.knobEl.style.top=`calc(50% + ${moveY}px)`;let direction=null;if(distance>15){const angle=Math.atan2(dy,dx)*(180/Math.PI);direction=getDirection(angle);if(direction!==joy.currentDirection){joy.currentDirection=direction;joy.displayEl.textContent=directionNames[direction]||direction;updateKeys(joy,direction);}}else{if(joy.currentDirection!==null){joy.currentDirection=null;joy.displayEl.textContent='‚è∏ IDLE';updateKeys(joy,null);}}}
function resetJoystick(joy){joy.knobEl.style.left='50%';joy.knobEl.style.top='50%';joy.knobEl.classList.remove('active');joy.currentDirection=null;joy.displayEl.textContent='‚è∏ IDLE';updateKeys(joy,null);}

// ===== EVENTS =====
joystickData.forEach(joy=>{
joy.containerEl.addEventListener('mousedown',e=>{joy.isDragging=true;joy.knobEl.classList.add('active');handleMove(joy,e.clientX,e.clientY);instructions.classList.add('hidden');e.preventDefault();});
document.addEventListener('mousemove',e=>{if(joy.isDragging)handleMove(joy,e.clientX,e.clientY);});
document.addEventListener('mouseup',()=>{if(joy.isDragging){joy.isDragging=false;resetJoystick(joy);}});
joy.containerEl.addEventListener('touchstart',e=>{joy.isDragging=true;joy.knobEl.classList.add('active');handleMove(joy,e.touches[0].clientX,e.touches[0].clientY);instructions.classList.add('hidden');e.preventDefault();},{passive:false});
document.addEventListener('touchmove',e=>{if(joy.isDragging){handleMove(joy,e.touches[0].clientX,e.touches[0].clientY);e.preventDefault();}},{passive:false});
document.addEventListener('touchend',e=>{if(joy.isDragging){joy.isDragging=false;resetJoystick(joy);}});
});

// ===== ACTION BUTTONS =====
document.querySelectorAll('.action-btn').forEach(btn=>{
const key=btn.dataset.key;
const pressBtn=e=>{e.preventDefault();btn.style.transform='scale(0.9)';sendKeyEvent(key,'keydown');instructions.classList.add('hidden');};
const releaseBtn=e=>{e.preventDefault();btn.style.transform='';sendKeyEvent(key,'keyup');};
btn.addEventListener('mousedown',pressBtn);btn.addEventListener('mouseup',releaseBtn);btn.addEventListener('mouseleave',releaseBtn);
btn.addEventListener('touchstart',pressBtn,{passive:false});btn.addEventListener('touchend',releaseBtn,{passive:false});btn.addEventListener('touchcancel',releaseBtn);
});

// ===== INIT =====
window.addEventListener('load',()=>{joystickData.forEach(initJoystick);});
window.addEventListener('resize',()=>{joystickData.forEach(initJoystick);});
window.addEventListener('orientationchange',()=>{setTimeout(()=>{joystickData.forEach(initJoystick);},100);});
document.addEventListener('gesturestart',e=>e.preventDefault());
document.addEventListener('gesturechange',e=>e.preventDefault());
document.addEventListener('click',e=>{if(e.target===gameFrame||e.target===document.body)gameFrame.focus();});
</script>
</body>
</html>
